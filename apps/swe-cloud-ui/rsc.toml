#:schema https://rustscript.dev/schemas/rustscript.schema.json
# RustScript Project Configuration for SWE Cloud UI
# CloudEmu + CloudKit + IAC Management Platform

[package]
name = "swe-cloud-ui"
version = "0.1.0"
edition = "2024"
description = "SWE Cloud Platform - Cloud Emulation, Infrastructure Toolkit, and IAC Management"
license = "MIT"

[build]
target = "web"
out_dir = "dist"
entry = "src/main.rsx"

[build.release]
backend = "llvm"
opt_level = 3
minify = true

[build.dev]
backend = "cranelift"
debug = true
source_map = true

[dev]
port = 3000
hmr = true

# Routing configuration (unified routes with workflows/contexts/presets)
[routing]
config = "routes.yaml"
enabled = true

# Bounded context enforcement
[boundaries]
enforce = false
strict = false
containers = ["features", "modules"]

# Compile all source files for full routing
[build.files]
include = ["src/**/*.rsx"]

# Path aliases for imports
[imports.aliases]
"@features" = "src/features"
"@modules" = "src/modules"
"@pages" = "src/pages"
"@configs" = "configs"

# YAML Configuration files
[configs]
activities = "configs/activities.yaml"
providers = "configs/providers.yaml"
environments = "configs/environments.yaml"
services = "configs/services.yaml"
workflows = "configs/workflows.yaml"
context_actions = "configs/context-actions.yaml"
presets = "configs/presets.yaml"
landings = "configs/landings.yaml"
theme = "configs/theme.yaml"

# Theme configuration
[theme]
config = "configs/theme.yaml"
default = "dark"
persist = true  # Save user preference to localStorage

# Context configuration
[context]
providers = "configs/providers.yaml"
environments = "configs/environments.yaml"
persist = true

[lint]
enabled = true

[lint.naming]
enforce = false
enforce_singular = false
enforce_kebab_case = false
enforce_type_suffix = false
enforce_hook_prefix = false

[lint.structure]
enforce = true

[test]
timeout = 10000
parallel = true

[test.e2e]
browser = "chromium"
headless = true

[test.e2e.preflight]
enabled = true
strict = true
# Allow dynamic testids that are generated at runtime
# These patterns match selectors like provider-option-aws, env-option-staging
allowed_patterns = [
    "provider-option-.*",
    "env-option-.*",
    "env-label-.*"
]

# Performance budgets for CI enforcement
[performance]
enabled = true
fail_on_exceed = true

# Build output size budgets
[performance.budgets]
wasm = "5KB"           # WASM bundle limit
css = "10KB"           # CSS bundle limit
js = "100KB"           # Runtime JS limit
total = "150KB"        # Total bundle limit

[performance.budgets.compressed]
wasm = "1KB"           # Brotli-compressed WASM
css = "2KB"            # Brotli-compressed CSS
js = "20KB"            # Brotli-compressed JS
total = "25KB"         # Total compressed bundle

# Runtime performance budgets
[performance.runtime]
wasm_init = "50ms"      # WASM instantiation time
app_init = "100ms"      # App initialization time
render = "16ms"         # Component render time (60fps)
memory_heap = "50MB"    # Max heap size

# Web Vitals budgets (Lighthouse metrics)
[performance.vitals]
fcp = "1.8s"            # First Contentful Paint
lcp = "2.5s"            # Largest Contentful Paint
tti = "3.8s"            # Time to Interactive
tbt = "200ms"           # Total Blocking Time
cls = "0.1"             # Cumulative Layout Shift
speed_index = "3.4s"    # Speed Index

[dependencies]
rsc-std = "0.1.0"
rsc-ui = "0.1.0"
rsc-routing = "0.1.0"
