# workflows.yaml - Workflow Definitions
# Multi-step task flows for cloud operations
version: 1

workflows:
  # Create Resource Workflow
  - id: create-resource
    name: Create Resource
    icon: plus-circle
    description: Create a new cloud resource
    context_required:
      - provider
    steps:
      - id: select-type
        title: Select Resource Type
        component: ResourceTypeSelector
        description: Choose the type of resource to create

      - id: configure
        title: Configure
        component: ResourceConfigurator
        description: Configure resource settings
        dynamic: true

      - id: review
        title: Review
        component: ResourceReview
        description: Review configuration before creating

      - id: create
        title: Create
        component: ResourceCreator
        description: Creating resource...
        action: create_resource
        async: true

    on_complete:
      navigate: "/cloudemu/{context.provider}/{step_data.resource_type}"
      toast: Resource created successfully

  # Deploy Infrastructure Workflow
  - id: deploy-infrastructure
    name: Deploy Infrastructure
    icon: upload-cloud
    description: Deploy infrastructure using Terraform
    role_required:
      - devops
      - admin
    context_required:
      - environment
    steps:
      - id: select-module
        title: Select Module
        component: ModuleSelector
        description: Choose a Terraform module to deploy

      - id: configure-vars
        title: Variables
        component: TerraformVariables
        description: Configure module variables

      - id: plan
        title: Plan
        component: TerraformPlan
        description: Running terraform plan...
        action: terraform_plan
        async: true

      - id: review-plan
        title: Review Changes
        component: PlanDiffViewer
        description: Review planned changes

      - id: apply
        title: Apply
        component: TerraformApply
        description: Applying changes...
        action: terraform_apply
        requires_confirmation: true
        async: true

    on_complete:
      navigate: "/iac/deployments/{result.deployment_id}"
      toast: Deployment completed

  # Debug Request Workflow
  - id: debug-request
    name: Debug Request
    icon: bug
    description: Debug and replay cloud API requests
    steps:
      - id: select-request
        title: Select Request
        component: RequestSelector
        description: Choose a request to debug

      - id: view-details
        title: Request Details
        component: RequestDetails
        description: View request and response details

      - id: modify
        title: Modify
        component: RequestModifier
        description: Modify request parameters
        optional: true

      - id: replay
        title: Replay
        component: RequestReplay
        description: Replay the request
        action: replay_request
        optional: true

    on_complete:
      toast: Request replayed
